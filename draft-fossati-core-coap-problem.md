---
title: Problem Details For CoAP APIs
abbrev: CoAP Problem
docname: draft-fossati-core-coap-problem-latest
category: std

ipr: trust200902
area: ART
workgroup: CoRE Working Group
keyword: CoAP, API, Problem Details

stand_alone: yes
pi: [toc, sortrefs, symrefs]

author:
 -
    ins: "T. Fossati"
    name: "Thomas Fossati"
    organization: "ARM"
    email: thomas.fossati@arm.com

--- abstract

This document defines a "problem detail" as a way to carry machine-readable
details of errors in a CoAP response to avoid the need to define new error
response formats for CoAP APIs.

--- middle

# Introduction

CoAP {{!RFC7252}} response codes are sometimes not sufficient to convey enough
information about an error to be helpful.

This specification defines simple and extensible CBOR {{!RFC7049}} format to
suit this purpose.  It is designed to be reused by CoAP APIs, which can
identify distinct "problem types" specific to their needs.

Thus, API clients can be informed of both the high-level error class (using the
response code) and the finer-grained details of the problem (using this
format).

The format presented is largely inspired by the Problem Details for HTTP APIs
defined in {{?RFC7807}}.

## Requirements Language

{::boilerplate bcp14}

# CoAP Problem Details Definition

A CoAP Problem Details is encoded as a CBOR map with the following members:

* "type" (uint) - code that uniquely identifies the problem type.  When this
  member is not present, its value is assumed to be 0, meaning that the problem
  has no additional semantics beyond that of the CoAP response code.

* "title" (text) - A short, human-readable summary of the problem type.  It
  SHOULD NOT change from occurrence to occurrence of the problem.

* "response-code" (8-bit uint) - The CoAP response code ({{!RFC7252}}, Section
  5.9) generated by the origin server for this occurrence of the problem.

* "detail" (text) - A human-readable explanation specific to this occurrence of
  the problem.

* "instance" (uri) - A URI reference that identifies the specific occurrence of
  the problem.  It may or may not yield further information if dereferenced.

Consumers MUST use "type" as the primary identifier for the problem type; the
"title" string is advisory and included only for users who are not aware of the
semantics of the URI and do not have the ability to discover them (e.g.,
offline log analysis).

The "response-code" member, if present, is only advisory; it conveys the CoAP
response code used for the convenience of the consumer.  Generators MUST use
the same response code in the actual CoAP response, to assure that generic CoAP
software that does not understand this format still behaves correctly.
Consumers can use the response-code member to determine what the original
response code used by the generator was, in cases where it has been changed
(e.g., by an intermediary or cache), and when message payloads persist without
CoAP information.  Generic CoAP software will still use the CoAP response code.

The "detail" member, if present, ought to focus on helping the client correct
the problem, rather than giving debugging information.  Consumers SHOULD NOT
parse the "detail" member for information; extensions (see {{sec-extensions}})
are more suitable and less error-prone ways to obtain such information.

Note that "instance" accepts relative URIs; this means that it must be resolved
relative to the document's base URI, as per {{!RFC3986}}, Section 5.

## CDDL

The definition in CDDL format {{!RFC8610}} is provided in {{fig-cddl}}.

~~~
coap-problem-details = {
  type => int,
  ? title => text,
  ? response-code => uint .size 1,
  ? detail => text,
  ? instance => uri,
  * $$coap-problem-details-extension,
}

type = 0
title = 1
response-code = 2
detail = 3
instance = 4
~~~
{: #fig-cddl title="CoAP Problem Details: CDDL Definition"}

# Extensibility

The format presented is extensible at two separate points that allow the
definition of:

* New error type values (see {{sec-new-types}}); and
* New attributes (see {{sec-extensions}}).

## Defining New Problem Attributes
{: #sec-extensions}

Problem type definitions MAY extend the problem details object with additional
members to convey additional, problem-specific information.

Clients consuming problem details MUST ignore any such extensions that they
don't recognize; this allows problem types to evolve and include additional
information in the future.

CoAP Problem Details can be extended via the coap-problem-details-extension
CDDL socket (see Section 3.9 of {{!RFC8610}}.

## Defining New Problem Types
{: #sec-new-types}

For now, this section only lists a bunch of requirements that need further
discussion.

* Support for private use:
  * An organisation (project, private company, SDO) wants to reserve a block of
    some size and does whatever it wants with it.  Clashes are not be possible
    if everyone behaves.
  * A completely private and self-contained project, wants to allocate its own
    set of error codes.  Clashes are possible, but irrelevant as long as the
    API does not transpire.
* Support for "official" protocols, which need:
  * Clean separation from the private use;
  * Clearly defined registration procedures;
  * Built-in delegation: no expert should be overlooking an immense and very
    diverse semantic space.  We should instead be able to delegate expert
    review to protocol-specific subregistries — a la ACME, JMAP, TRANS.

The main difference with {{RFC7807}} is that, because we want the encoding to
be very efficient, we also avoid using URNs to create separate namespaces.

# Security Considerations

The security considerations of {{?RFC7807}} apply in full.

# IANA Considerations

## Registration of a Content-Format identifier for application/coap-problem+cbor

This document requests that IANA registers the following Content-Format to the
"CoAP Content-Formats" subregistry, within the "Constrained RESTful
Environments (CoRE) Parameters" registry, from the Expert Review space
(0..255):

   | Media Type                    | Encoding | ID   | Reference |
   | application/coap-problem+cbor | ---      | TBD1 | RFCthis   |

## New Registries

This document requests that IANA create the following new registries:

* CoAP Problem Details ({{iana-details-registry}})
* CoAP Problem Types ({{iana-types-registry}})

### CoAP Problem Details Registry
{: #iana-details-registry}

The "CoAP Problem Details" registry keeps track of the allocation of the
integer values used as index values in the coap-problem-details CBOR map.

Future registrations for this registry are to be made based on {{!RFC8126}} as
described in {{tab-details}}.

   | Range            | Registration Procedures |
   | 0...N            | Standards Action        |
   | N+1...4294967295 | Specification Required  |
{: #tab-details title="CoAP Problem Details Registration Procedures"}

All negative values are reserved for Private Use.

Initial registrations for the "CoAP Problem Details" registry are provided in
{{tab-details-init}}.  Assignments consist of an integer index value, the item
name, and a reference to the defining specification.

   | Index | Index Name    | Specification |
   | 0     | type          | RFCthis       |
   | 1     | title         | RFCthis       |
   | 2     | response-code | RFCthis       |
   | 3     | detail        | RFCthis       |
   | 4     | instance      | RFCthis       |
{: #tab-details-init title="CoAP Problem Details Initial Registrations"}

### CoAP Problem Types Registry
{: #iana-types-registry}

The "CoAP Problem Types" registry keeps track of the problem type values.

Future registrations for this registry are to be made based on {{!RFC8126}} as
described in {{tab-types}}.

   | Range            | Registration Procedures |
   | 0...M            | Standards Action        |
   | M+1...4294967295 | Specification Required  |
{: #tab-types title="CoAP Problem Types Registration Procedures"}

All negative values are reserved for Private Use.

This specification reserves the use of one value as a problem type: The 0
value, when used as a problem type, indicates that the problem has no
additional semantics beyond that of the CoAP response code.

The initial registration for the "CoAP Problem Types" registry is provided in
{{tab-types-init}}.  Assignments consist of an integer index value, the item
name, and a reference to the defining specification.

   | Value | Description | Specification |
   | 0     | The problem has no additional semantics beyond that of the CoAP response code | RFCthis |
{: #tab-types-init title="CoAP Problem Types Initial Registrations"}

--- back

# Acknowledgments
{: numbered="no"}

Mark Nottingham and Erik Wilde, authors of RFC 7807.
